# Example Timing Log Output

This document shows example log output with timing information that will be generated by the application.

## Startup Process

```json
{"level":30,"time":1704067200000,"msg":"[TIMING] Starting: startup","operation":"startup","timestamp":"2024-01-01T00:00:00.000Z"}
{"level":30,"time":1704067200100,"msg":"Initializing Supabase archive storage"}
{"level":20,"time":1704067200100,"msg":"[TIMING] Starting: archive_store_init","operation":"archive_store_init","timestamp":"2024-01-01T00:00:00.100Z"}
{"level":30,"time":1704067200150,"msg":"Supabase ArchiveStore initialized"}
{"level":30,"time":1704067200150,"msg":"[TIMING] Completed: archive_store_init (0.05s)","operation":"archive_store_init","durationMs":50,"durationSec":"0.05s","timestamp":"2024-01-01T00:00:00.150Z","success":true}
{"level":30,"time":1704067200200,"msg":"SYNC_ARCHIVES_ON_STARTUP enabled, checking for new archives..."}
{"level":20,"time":1704067200200,"msg":"[TIMING] Starting: archive_sync","operation":"archive_sync","timestamp":"2024-01-01T00:00:00.200Z"}
{"level":30,"time":1704067200200,"msg":"Starting archive sync from lovdata-api"}
{"level":20,"time":1704067200200,"msg":"[TIMING] Starting: list_public_data","operation":"list_public_data","timestamp":"2024-01-01T00:00:00.200Z"}
{"level":30,"time":1704067201500,"msg":"[TIMING] Completed: list_public_data (1.30s)","operation":"list_public_data","durationMs":1300,"durationSec":"1.30s","timestamp":"2024-01-01T00:00:01.500Z","fileCount":4}
{"level":30,"time":1704067201500,"msg":"Found archives in lovdata-api","archiveCount":4}
{"level":20,"time":1704067201500,"msg":"[TIMING] Starting: check_archive_processed","operation":"check_archive_processed","filename":"gjeldende-lover.tar.bz2","timestamp":"2024-01-01T00:00:01.500Z"}
{"level":30,"time":1704067201600,"msg":"[TIMING] Completed: check_archive_processed (0.10s)","operation":"check_archive_processed","durationMs":100,"durationSec":"0.10s","timestamp":"2024-01-01T00:00:01.600Z","filename":"gjeldende-lover.tar.bz2","isProcessed":true}
{"level":20,"time":1704067201600,"msg":"Archive already processed, skipping","filename":"gjeldende-lover.tar.bz2"}
{"level":20,"time":1704067201600,"msg":"[TIMING] Starting: process_archive","operation":"process_archive","filename":"lovtidend-avd1-2025.tar.bz2","timestamp":"2024-01-01T00:00:01.600Z"}
{"level":20,"time":1704067201600,"msg":"[TIMING] Starting: fetch_archive_stream","operation":"fetch_archive_stream","filename":"lovtidend-avd1-2025.tar.bz2","timestamp":"2024-01-01T00:00:01.600Z"}
{"level":30,"time":1704067205000,"msg":"[TIMING] Completed: fetch_archive_stream (3.40s)","operation":"fetch_archive_stream","durationMs":3400,"durationSec":"3.40s","timestamp":"2024-01-01T00:00:05.000Z","filename":"lovtidend-avd1-2025.tar.bz2"}
{"level":20,"time":1704067205000,"msg":"[TIMING] Starting: process_archive_stream","operation":"process_archive_stream","filename":"lovtidend-avd1-2025.tar.bz2","timestamp":"2024-01-01T00:00:05.000Z"}
{"level":20,"time":1704067210000,"msg":"[TIMING] Checkpoint: process_archive_stream -> processed_100_documents (5.00s)","operation":"process_archive_stream","checkpoint":"processed_100_documents","elapsedMs":5000,"elapsedSec":"5.00s","timestamp":"2024-01-01T00:00:10.000Z","filename":"lovtidend-avd1-2025.tar.bz2"}
{"level":20,"time":1704067215000,"msg":"[TIMING] Checkpoint: process_archive_stream -> processed_200_documents (10.00s)","operation":"process_archive_stream","checkpoint":"processed_200_documents","elapsedMs":10000,"elapsedSec":"10.00s","timestamp":"2024-01-01T00:00:15.000Z","filename":"lovtidend-avd1-2025.tar.bz2"}
{"level":30,"time":1704067220000,"msg":"[TIMING] Completed: process_archive_stream (15.00s)","operation":"process_archive_stream","durationMs":15000,"durationSec":"15.00s","timestamp":"2024-01-01T00:00:20.000Z","filename":"lovtidend-avd1-2025.tar.bz2","documentCount":1325}
{"level":20,"time":1704067220000,"msg":"[TIMING] Starting: save_documents_to_db","operation":"save_documents_to_db","filename":"lovtidend-avd1-2025.tar.bz2","documentCount":1325,"timestamp":"2024-01-01T00:00:20.000Z"}
{"level":20,"time":1704067220000,"msg":"[TIMING] Starting: replace_documents","operation":"replace_documents","filename":"lovtidend-avd1-2025.tar.bz2","documentCount":1325,"timestamp":"2024-01-01T00:00:20.000Z"}
{"level":20,"time":1704067220000,"msg":"[TIMING] Starting: upsert_archive","operation":"upsert_archive","filename":"lovtidend-avd1-2025.tar.bz2","timestamp":"2024-01-01T00:00:20.000Z"}
{"level":30,"time":1704067220100,"msg":"[TIMING] Completed: upsert_archive (0.10s)","operation":"upsert_archive","durationMs":100,"durationSec":"0.10s","timestamp":"2024-01-01T00:00:20.100Z","filename":"lovtidend-avd1-2025.tar.bz2"}
{"level":20,"time":1704067220100,"msg":"[TIMING] Starting: delete_existing_documents","operation":"delete_existing_documents","filename":"lovtidend-avd1-2025.tar.bz2","timestamp":"2024-01-01T00:00:20.100Z"}
{"level":30,"time":1704067220200,"msg":"[TIMING] Completed: delete_existing_documents (0.10s)","operation":"delete_existing_documents","durationMs":100,"durationSec":"0.10s","timestamp":"2024-01-01T00:00:20.200Z","filename":"lovtidend-avd1-2025.tar.bz2"}
{"level":20,"time":1704067220200,"msg":"[TIMING] Starting: insert_documents_batch","operation":"insert_documents_batch","filename":"lovtidend-avd1-2025.tar.bz2","batchIndex":1,"batchCount":3,"batchSize":500,"timestamp":"2024-01-01T00:00:20.200Z"}
{"level":30,"time":1704067221000,"msg":"[TIMING] Completed: insert_documents_batch (0.80s)","operation":"insert_documents_batch","durationMs":800,"durationSec":"0.80s","timestamp":"2024-01-01T00:00:21.000Z","filename":"lovtidend-avd1-2025.tar.bz2","batchIndex":1,"batchCount":3,"batchSize":500}
{"level":20,"time":1704067221000,"msg":"[TIMING] Starting: insert_documents_batch","operation":"insert_documents_batch","filename":"lovtidend-avd1-2025.tar.bz2","batchIndex":2,"batchCount":3,"batchSize":500,"timestamp":"2024-01-01T00:00:21.000Z"}
{"level":30,"time":1704067221800,"msg":"[TIMING] Completed: insert_documents_batch (0.80s)","operation":"insert_documents_batch","durationMs":800,"durationSec":"0.80s","timestamp":"2024-01-01T00:00:21.800Z","filename":"lovtidend-avd1-2025.tar.bz2","batchIndex":2,"batchCount":3,"batchSize":500}
{"level":20,"time":1704067221800,"msg":"[TIMING] Starting: insert_documents_batch","operation":"insert_documents_batch","filename":"lovtidend-avd1-2025.tar.bz2","batchIndex":3,"batchCount":3,"batchSize":325,"timestamp":"2024-01-01T00:00:21.800Z"}
{"level":30,"time":1704067222500,"msg":"[TIMING] Completed: insert_documents_batch (0.70s)","operation":"insert_documents_batch","durationMs":700,"durationSec":"0.70s","timestamp":"2024-01-01T00:00:22.500Z","filename":"lovtidend-avd1-2025.tar.bz2","batchIndex":3,"batchCount":3,"batchSize":325}
{"level":30,"time":1704067222500,"msg":"Replaced documents in Supabase","archive":"lovtidend-avd1-2025.tar.bz2","documents":1325}
{"level":30,"time":1704067222500,"msg":"[TIMING] Completed: replace_documents (2.30s)","operation":"replace_documents","durationMs":2300,"durationSec":"2.30s","timestamp":"2024-01-01T00:00:22.500Z","filename":"lovtidend-avd1-2025.tar.bz2","documentCount":1325,"success":true}
{"level":30,"time":1704067222500,"msg":"[TIMING] Completed: save_documents_to_db (2.30s)","operation":"save_documents_to_db","durationMs":2300,"durationSec":"2.30s","timestamp":"2024-01-01T00:00:22.500Z","filename":"lovtidend-avd1-2025.tar.bz2","documentCount":1325}
{"level":30,"time":1704067222500,"msg":"Archive documents saved to Supabase","filename":"lovtidend-avd1-2025.tar.bz2","documentCount":1325}
{"level":30,"time":1704067222500,"msg":"[TIMING] Completed: process_archive (20.90s)","operation":"process_archive","durationMs":20900,"durationSec":"20.90s","timestamp":"2024-01-01T00:00:22.500Z","filename":"lovtidend-avd1-2025.tar.bz2","documentCount":1325}
{"level":30,"time":1704067222500,"msg":"Archive processed successfully","filename":"lovtidend-avd1-2025.tar.bz2"}
{"level":30,"time":1704067223000,"msg":"[TIMING] Completed: archive_sync (22.80s)","operation":"archive_sync","durationMs":22800,"durationSec":"22.80s","timestamp":"2024-01-01T00:00:23.000Z","checked":4,"processed":1,"skipped":3,"errors":0}
{"level":30,"time":1704067223000,"msg":"Archive sync completed","checked":4,"processed":1,"skipped":3,"errors":0}
{"level":20,"time":1704067223000,"msg":"[TIMING] Checkpoint: startup -> services_ready (23.00s)","operation":"startup","checkpoint":"services_ready","elapsedMs":23000,"elapsedSec":"23.00s","timestamp":"2024-01-01T00:00:23.000Z"}
{"level":30,"time":1704067223100,"msg":"[TIMING] Completed: startup (23.10s)","operation":"startup","durationMs":23100,"durationSec":"23.10s","timestamp":"2024-01-01T00:00:23.100Z","port":3000}
{"level":30,"time":1704067223100,"msg":"Backend listening","port":3000}
```

## API Request: Assistant Run

```json
{"level":20,"time":1704067300000,"msg":"[TIMING] Starting: assistant_run","operation":"assistant_run","endpoint":"/assistant/run","userId":"user-123","questionLength":45,"timestamp":"2024-01-01T00:01:40.000Z"}
{"level":20,"time":1704067300000,"msg":"[TIMING] Starting: search_lovdata","operation":"search_lovdata","query":"Hva er reglene for arbeidstid?","queryLength":30,"page":1,"pageSize":5,"offset":0,"timestamp":"2024-01-01T00:01:40.000Z"}
{"level":20,"time":1704067300000,"msg":"[TIMING] Starting: db_search","operation":"db_search","query":"Hva er reglene for arbeidstid?","queryLength":30,"limit":5,"offset":0,"timestamp":"2024-01-01T00:01:40.000Z"}
{"level":20,"time":1704067300000,"msg":"[TIMING] Starting: db_text_search","operation":"db_text_search","tsQuery":"arbeidstid:*","limit":5,"offset":0,"timestamp":"2024-01-01T00:01:40.000Z"}
{"level":30,"time":1704067300500,"msg":"[TIMING] Completed: db_text_search (0.50s)","operation":"db_text_search","durationMs":500,"durationSec":"0.50s","timestamp":"2024-01-01T00:01:40.500Z","tsQuery":"arbeidstid:*","limit":5,"offset":0,"resultCount":5,"totalCount":127}
{"level":20,"time":1704067300500,"msg":"[TIMING] Starting: generate_snippets","operation":"generate_snippets","documentCount":5,"timestamp":"2024-01-01T00:01:40.500Z"}
{"level":30,"time":1704067300600,"msg":"[TIMING] Completed: generate_snippets (0.10s)","operation":"generate_snippets","durationMs":100,"durationSec":"0.10s","timestamp":"2024-01-01T00:01:40.600Z","documentCount":5,"snippetCount":5}
{"level":30,"time":1704067300600,"msg":"[TIMING] Completed: db_search (0.60s)","operation":"db_search","durationMs":600,"durationSec":"0.60s","timestamp":"2024-01-01T00:01:40.600Z","query":"Hva er reglene for arbeidstid?","queryLength":30,"limit":5,"offset":0,"hits":5,"total":127}
{"level":30,"time":1704067300600,"msg":"[TIMING] Completed: search_lovdata (0.60s)","operation":"search_lovdata","durationMs":600,"durationSec":"0.60s","timestamp":"2024-01-01T00:01:40.600Z","query":"Hva er reglene for arbeidstid?","queryLength":30,"page":1,"pageSize":5,"offset":0,"totalHits":127,"hitsReturned":5,"searchedFilesCount":3,"totalPages":26}
{"level":20,"time":1704067301000,"msg":"[TIMING] Starting: agent.answer","operation":"agent.answer","timestamp":"2024-01-01T00:01:40.600Z"}
{"level":30,"time":1704067315000,"msg":"[TIMING] Completed: agent.answer (9.40s)","operation":"agent.answer","durationMs":9400,"durationSec":"9.40s","timestamp":"2024-01-01T00:01:49.600Z"}
{"level":30,"time":1704067315000,"msg":"[TIMING] Completed: assistant_run (11.50s)","operation":"assistant_run","durationMs":11500,"durationSec":"11.50s","timestamp":"2024-01-01T00:01:51.500Z","endpoint":"/assistant/run","userId":"user-123","questionLength":45,"success":true}
```

## API Request: Get Document XML

```json
{"level":20,"time":1704067400000,"msg":"[TIMING] Starting: get_document_xml","operation":"get_document_xml","endpoint":"/documents/xml","filename":"gjeldende-lover.tar.bz2","member":"nl/LOV-2005-06-17-62.xml","format":undefined,"timestamp":"2024-01-01T00:03:20.000Z"}
{"level":20,"time":1704067400000,"msg":"[TIMING] Starting: get_document_record","operation":"get_document_record","filename":"gjeldende-lover.tar.bz2","member":"nl/LOV-2005-06-17-62.xml","timestamp":"2024-01-01T00:03:20.000Z"}
{"level":30,"time":1704067400100,"msg":"[TIMING] Completed: get_document_record (0.10s)","operation":"get_document_record","durationMs":100,"durationSec":"0.10s","timestamp":"2024-01-01T00:03:20.100Z","filename":"gjeldende-lover.tar.bz2","member":"nl/LOV-2005-06-17-62.xml","found":true}
{"level":20,"time":1704067400100,"msg":"[TIMING] Starting: read_document_text","operation":"read_document_text","filename":"gjeldende-lover.tar.bz2","member":"nl/LOV-2005-06-17-62.xml","timestamp":"2024-01-01T00:03:20.100Z"}
{"level":20,"time":1704067400100,"msg":"[TIMING] Starting: get_document_content","operation":"get_document_content","filename":"gjeldende-lover.tar.bz2","member":"nl/LOV-2005-06-17-62.xml","timestamp":"2024-01-01T00:03:20.100Z"}
{"level":30,"time":1704067400150,"msg":"[TIMING] Completed: get_document_content (0.05s)","operation":"get_document_content","durationMs":50,"durationSec":"0.05s","timestamp":"2024-01-01T00:03:20.150Z","filename":"gjeldende-lover.tar.bz2","member":"nl/LOV-2005-06-17-62.xml","success":true,"found":true,"contentLength":45230}
{"level":30,"time":1704067400150,"msg":"[TIMING] Completed: read_document_text (0.05s)","operation":"read_document_text","durationMs":50,"durationSec":"0.05s","timestamp":"2024-01-01T00:03:20.150Z","filename":"gjeldende-lover.tar.bz2","member":"nl/LOV-2005-06-17-62.xml","textLength":45230}
{"level":30,"time":1704067400200,"msg":"[TIMING] Completed: get_document_xml (0.20s)","operation":"get_document_xml","durationMs":200,"durationSec":"0.20s","timestamp":"2024-01-01T00:03:20.200Z","endpoint":"/documents/xml","filename":"gjeldende-lover.tar.bz2","member":"nl/LOV-2005-06-17-62.xml","format":undefined,"success":true}
```

## Pretty Format (Development Mode)

In development mode with `pino-pretty`, the logs will appear like this:

```
[2024-01-01 00:00:00.000] INFO: [TIMING] Starting: startup
    operation: "startup"
    timestamp: "2024-01-01T00:00:00.000Z"

[2024-01-01 00:00:00.100] INFO: Initializing Supabase archive storage

[2024-01-01 00:00:00.100] DEBUG: [TIMING] Starting: archive_store_init
    operation: "archive_store_init"
    timestamp: "2024-01-01T00:00:00.100Z"

[2024-01-01 00:00:00.150] INFO: [TIMING] Completed: archive_store_init (0.05s)
    operation: "archive_store_init"
    durationMs: 50
    durationSec: "0.05s"
    timestamp: "2024-01-01T00:00:00.150Z"
    success: true

[2024-01-01 00:00:23.100] INFO: [TIMING] Completed: startup (23.10s)
    operation: "startup"
    durationMs: 23100
    durationSec: "23.10s"
    timestamp: "2024-01-01T00:00:23.100Z"
    port: 3000

[2024-01-01 00:00:23.100] INFO: Backend listening
    port: 3000
```

## Filtering Timing Logs

You can filter timing logs using:

```bash
# View only timing logs
cat server.log | grep "\[TIMING\]"

# View timing logs for a specific operation
cat server.log | grep "operation.*archive_sync"

# View slow operations (>1 second)
cat server.log | jq 'select(.msg | contains("[TIMING]")) | select(.durationMs > 1000)'

# View all operations sorted by duration
cat server.log | jq 'select(.msg | contains("[TIMING] Completed")) | {operation: .operation, duration: .durationSec, metadata: .}' | jq -s 'sort_by(.duration)'
```

